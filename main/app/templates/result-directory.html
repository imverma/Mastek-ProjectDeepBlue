{% extends "base.html" %}

{% block content %}
<nav class="navbar" style="background-color: #4A33E8;">
    <a class="navbar-brand text-white" href="#">EYC3PDBS3</a>
    <ul class="navbar-nav ml-auto">
        <li class="nav-item">
            <a href="/rejected-list"><button type="button" class="btn btn-default mr-3">Check the Rejected List</button></a>
            <a href="/display-single"><button class="btn btn-default" type="submit">Upload Singular Images</button></a>        
        </li>
    </ul>
</nav>
<br>
<br><br>
<div class="container">
    
    <div class="container">
        <div style="background-color: #4A33E8;" class="rounded-top m-0">
            <h3 class="p-3 text-white">Pre Post Matching</h3>
        </div>
        
        {% if match[0]|length > 0 %}
        <div class="alert alert-info m-0" role="alert">
            Number of flagged results : {{match[0]|length}}<br>
            Kindly Accept if you find them to be OK, Reject if you find them to be the same people
        </div>
        <div class="row">
            {% for t in range(match[0]|length) %}
            
                <div class="col-md-4 p-3" id="pre_post_{{loop.index}}">
                    <div class="card text-center">
                        <div class="card-header">
                            Image set {{t}}
                        </div>
                        <div class="row card-body">
                            <div class="col-sm text-center">
                                <img class="img-fluid" height="140" width="140" src="static{{ match[1][t] }}">    
                            </div>
                            <div class="col-sm text-center">
                                <img class="img-fluid" height="140" width="140" src="static{{ match[2][t] }}">    
                            </div>
                        </div>
                        <div class="card-footer text-muted">
                        Match = {{ ((0.6/(0.6+match[0][t]))*100) }}%
                        <br>
                        </div>
                        <div class="card-footer text-muted">
                            <button type="submit" onclick="reject('{{loop.index}}','#pre_post_','{{match[1][t]}}')" class="btn btn-outline-danger d-inline-block .float-left">Reject</button>
                            <button type="submit" onclick="accept('{{loop.index}}','#pre_post_','{{match[1][t]}}')" class="btn btn-outline-success d-inline-block .float-right">Accept</button>
                        </div>
                    </div>
                </div>
            
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-success" role="alert">
            There are no discrepancies
        </div>
        {% endif %}
    </div>
    
    <hr>

    <div class="container">
        <div style="background-color: #4A33E8;" class="rounded-top m-0">
            <h3 class="p-3 text-white">Pre Pre Matching</h3>
        </div>
        
        {% if pre_match[0]|length > 0 %}
        <div class="alert alert-info rounded-bottom m-0 rounded-top-0 " role="alert">
            Number of flagged results : {{pre_match[0]|length}}<br>
            Kindly Accept if you find them to be OK, Reject if you find them to be the same people
        </div>
        <div class="row">
            {% for t in range(pre_match[0]|length) %}
            
                <div class="col-md-4 p-3" id="pre_pre_{{loop.index}}">
                    <div class="card text-center">
                        <div class="card-header">
                            Image set {{t}}
                        </div>
                        <div class="row card-body">
                            <div class="col-sm text-center">
                                <img class="img-fluid" height="140" width="140" src="static{{ pre_match[1][t] }}">    
                            </div>
                            <div class="col-sm text-center">
                                <img class="img-fluid" height="140" width="140" src="static/{{ pre_match[2][t] }}">    
                            </div>
                        </div>
                        <div class="card-footer text-muted">
                        Match = {{ ((0.9/(0.9+pre_match[0][t]))*100) }}%
                        <br>
                        </div>
                        <div class="card-footer text-muted">
                            <button type="submit" onclick="reject('{{loop.index}}','#pre_pre_','{{pre_match[1][t]}}')" class="btn btn-outline-danger d-inline-block .float-left">Reject</button>
                            <button type="submit" onclick="accept('{{loop.index}}','#pre_pre_','{{pre_match[1][t]}}')" class="btn btn-outline-success d-inline-block .float-right">Accept</button>
                        </div>
                    </div>
                </div>
            
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-success" role="alert">
            There are no discrepancies
        </div>
        {% endif %}
    </div>

    <hr>

    <div class="container">
        <div style="background-color: #4A33E8;" class="rounded-top m-0">
            <h3 class="p-3 text-white">Post Post Matching</h3>
        </div>
        
        {% if post_match[0]|length > 0 %}
        <div class="alert alert-info m-0" role="alert">
            Number of flagged results : {{post_match[0]|length}}<br>
            Kindly Accept if you find them to be OK, Reject if you find them to be the same people
        </div>
        <div class="row">
            {% for t in range(post_match[0]|length) %}
            
                <div class="col-md-4 p-3" id="post_post_{{loop.index}}">
                    <div class="card text-center">
                        <div class="card-header">
                            Image set {{t}}
                        </div>
                        <div class="row card-body">
                            <div class="col-sm text-center">
                                <img class="img-fluid" height="140" width="140" src="static{{ post_match[1][t] }}">    
                            </div>
                            <div class="col-sm text-center">
                                <img class="img-fluid" height="140" width="140" src="static/{{ post_match[2][t] }}">    
                            </div>
                        </div>
                        <div class="card-footer text-muted">
                        Match = {{ ((0.9/(0.9+post_match[0][t]))*100)|round|int }}%
                        <br>
                        </div>
                        <div class="card-footer text-muted">
                            <button type="submit" onclick="reject('{{loop.index}}','#post_post_','{{post_match[1][t]}}')" class="btn btn-outline-danger d-inline-block .float-left">Reject</button>
                            <button type="submit" onclick="accept('{{loop.index}}','#post_post_','{{post_match[1][t]}}')" class="btn btn-outline-success d-inline-block .float-right">Accept</button>
                        </div>
                    </div>
                </div>
            
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-success" role="alert">
            There are no discrepancies
        </div>
        {% endif %}
    </div>

    <hr>

    <div>
        <div style="background-color: #4A33E8;" class="rounded-top m-0">
            <h3 class="p-3 text-white">Photoshopped Images</h3>
        </div>
        
        {% if ps_pre|length > 0 or ps_post|length > 0 %}
        <div class="row alert alert-success" role="alert">
            Kindly Accept if you find them to be OK, Reject if you find them to be the same people
        </div>
        <div>
            {% for t in range(ps_post|length) %}
            
                <div class="col-md-4 p-3" id="ps_post_{{loop.index}}">
                    <div class="card text-center">
                        <div class="card-header">
                        Image set {{t}}
                        </div>
                        <div class="row card-body">
                            <div class="col-sm text-center">
                                <img height="140" width="140" src="{{ps_post[t] }}">    
                            </div>
                            <div class="col-sm text-center">
                                <img height="140" width="140" src="{{ps_post_ela[t] }}">    
                            </div>
                        </div>
                        <div class="card-footer text-muted">
                        <br>
                        </div>
                        <div class="card-footer text-muted">
                            <button type="submit" onclick="reject({{loop.index}},'#ps_post_','{{ps_post[t]}}')" class="btn btn-outline-danger d-inline-block .float-left">Reject</button>
                            <button type="submit" onclick="accept({{loop.index}},'#ps_post_','{{ps_post[t]}}')" class="btn btn-outline-success d-inline-block .float-right">Accept</button>
                        </div>
                    </div>
                </div>
            
            {% endfor %}
        </div>

        <div>
            {% for t in range(ps_pre|length) %}
            
                <div class="col-md-4 p-3" id="ps_pre_{{loop.index}}">
                    <div class="card text-center">
                        <div class="card-header">
                        Image set {{t}}
                        </div>
                        <div class="row card-body">
                            <div class="col-sm text-center">
                                <img height="140" width="140" src="{{ps_pre[t] }}">
                            </div>
                            <div class="col-sm text-center">
                                <img height="140" width="140" src="{{ps_pre_ela[t] }}">
                            </div>
                        </div>
                        <div class="card-footer text-muted">
                        <br>
                        </div>
                        <div class="card-footer text-muted">
                            <button type="submit" onclick="reject({{loop.index}},'#ps_pre_','{{ps_post[t]}}')" class="btn btn-outline-danger d-inline-block .float-left">Reject</button>
                            <button type="submit" onclick="accept({{loop.index}},'#ps_pre_','{{ps_post[t]}}')" class="btn btn-outline-success d-inline-block .float-right">Accept</button>
                        </div>
                    </div>
                </div>
            
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-success" role="alert">
            There are no photoshopped Images
        </div>
        {% endif %}
    </div>

</div>

<script>
    
    var list = []
    var idx
    var demo = 1

    var socket = io.connect('http://0.0.0.0:5000/');

    $(document).ready(function(){
        

        socket.on('connect',function(){
            socket.emit('connection', {data: "Connection Checking"});
        });
    })
    
    function reject(index, id, img)
    {
        $("div").remove(id+index)
        idx = index
        socket.emit('reject',img)
    }

    function accept(index, id, img)
    {
        $("div").remove(id+index)
        idx = index
        socket.emit('accept',img)
    }

</script>


{% endblock %}